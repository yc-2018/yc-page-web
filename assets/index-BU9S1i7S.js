import{r as R,C as O,j as e,B as D,o as z,a as J,b3 as N}from"./index-f1YMPRds.js";import{m as B}from"./myAxios-BIVIHpI2.js";import{J as A}from"./JWTUtils-DLG_3aPf.js";import{d as r,a as m,D as _}from"./DateUtils-_0hZsMQ3.js";import{M as C}from"./MyEmpty-2JcUG-sm.js";import{R as I,C as L}from"./row-Dx7pK_Vw.js";import{P as W}from"./index-BEIOo5xS.js";import{S as E}from"./index-D_7exumZ.js";import{E as U}from"./index-DvQUwNhg.js";import{C as K}from"./index-Co00fZZh.js";import{I as X,_ as q}from"./AntdIcon-DOlxDjpc.js";import{L as G}from"./LeftOutlined-Re7l8AMl.js";import"./index-C0RmN517.js";import"./PurePanel-_rSNh8S4.js";import"./useMergedState-DTxgtxFb.js";import"./index-uePLcMZT.js";import"./isMobile-DjGTsQxe.js";import"./Overflow-C8ZKkp8Z.js";import"./index-BzYRzDzH.js";import"./move-9h65hhgq.js";import"./useIcons-b-vPc-aM.js";import"./DownOutlined-moeKAr2a.js";import"./SearchOutlined-Cmz87yFm.js";import"./mediaQueryUtil-BSyvLspT.js";import"./colors-CI0yjLlk.js";import"./EllipsisOutlined-DD2lymnb.js";import"./PlusOutlined-ByZyTB3m.js";import"./Dropdown-DjH7BmH_.js";var Q=function(a,d){return R.createElement(X,q({},a,{ref:d,icon:G}))},V=R.forwardRef(Q);async function Z(o){O.setLoading(!0);const a=await B("/other/dySeeTime",o);return a.success&&O.setLoading(!1,"记录成功","success"),a.success}async function ee(o){O.setLoading(!0);const{data:a}=await B("/other/getSeeTime",o);return O.setLoading(!1),a??[]}const F={1:"日",2:"周",3:"月",4:"年"},Y={1:"day",2:"week",3:"month",4:"year"},b={周:2,月:3,年:4},te=["周一","周二","周三","周四","周五","周六","周日"];let c=[];const se=({seeDataList:o})=>{const a=()=>c.length*60*60*1e3,d=t=>`${r(t.endTime).diff(r(t.startTime))/a()*100}%`,j=t=>{const n=r(t.endTime).diff(r(t.startTime));return`${t.thisTime*1e3/n*100}%`},p=(t,n)=>({background:{抖音刷视频外:"#c5daff",抖音刷视频内:"#92b8fa",抖音用户页外:"#fce1ce",抖音用户页内:"#fcc5a3",抖音搜索页外:"#fccedd",抖音搜索页内:"#ffabc6"}[`${t.remark}${n}`]||(n==="外"?"#e1e1e1":"#c0c0c0"),width:n==="外"?d(t):j(t),height:25,borderRadius:5,margin:n==="外"?"5px 0":"unset"}),x=t=>{const n=r(o[0].startTime).startOf("day"),s=c.indexOf(r(t).hour());return`${r(t).hour(s).diff(n)/a()*100}%`};return(()=>{if(c=[],o.length===0)return;for(let s=0;s<o.length;s++){const l=o[s];let u=r(l.startTime).hour(),g=r(l.endTime).hour();g-u<0&&(g=23);for(let f=u;f<=g;f++)!c.includes(f)&&c.push(f)}c.sort((s,l)=>s-l);const t=[c[0]];for(let s=1;s<c.length;s++){const l=c[s]-c[s-1];l===2&&t.push(c[s-1]+1),l>2&&t.push(-1),t.push(c[s])}const n=c[c.length-1];t.push((n+1)%24),n===23&&t.push((n+2)%24),c=t})(),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column-reverse",height:"calc(-153px + 100vh)",overflow:"auto"},children:[o.filter(t=>t.startTime).map(t=>e.jsxs(I,{children:[e.jsx("div",{style:{marginLeft:x(t.startTime)}}),e.jsx(W,{placement:"top",content:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("b",{style:{color:"#646464",fontSize:18},children:t.remark}),e.jsx("br",{}),e.jsxs("b",{children:[r(t.startTime).format("HH:mm:ss")," ~ ",r(t.endTime).format("HH:mm:ss")]}),e.jsxs("div",{children:["打开时间：",m.millisecondFormat(r(t.endTime).diff(r(t.startTime)))]}),e.jsxs("div",{children:["观看时间：",m.secondFormat(t.thisTime)]}),e.jsxs("div",{children:["至此已览：",m.secondFormat(t.totalDuration)]})]}),children:e.jsx("div",{style:p(t,"外"),children:e.jsx("div",{style:p(t,"内")})})}),e.jsx("span",{style:{lineHeight:"34px",marginLeft:3,color:"#999"},children:m.millisecondFormat(r(t.endTime).diff(r(t.startTime)))})]},t.startTime)),o.length===0&&e.jsx(C,{describe:"这天没有观看时间数据哦,真棒!",style:{width:"40vw",margin:" 0 auto"}})]}),e.jsx(I,{children:c.map((t,n)=>e.jsx("div",{style:{textAlign:"center",fontWeight:"bold",width:`${100/c.length}%`,background:n%2===0?"#c4ffa9":"#b9edff"},children:t===-1?"...":`${t}`},n))})]})},re=({seeDataList:o=[]})=>o.length>0?e.jsxs(E,{size:"large",children:[e.jsxs("b",{children:["总时长：",m.millisecondFormat(o.map(a=>{const d=r(a.startTime);return r(a.endTime).diff(d)}).reduce((a,d)=>a+d,0))]}),e.jsxs("b",{children:["观看时长：",m.secondFormat(o.reduce((a,d)=>a+d.thisTime,0))]}),e.jsxs("b",{children:["共看了 ",e.jsx("span",{style:{color:"#ff0000"},children:o.length})," 次"]})]}):e.jsx(e.Fragment,{}),ne=({seeDataList:o,seeDataConfig:a,onClick:d})=>{const j=()=>{if(a.seeRange===b.周)return e.jsx("div",{style:{display:"flex",textAlign:"center"},children:te.map((t,n)=>e.jsx("div",{style:{width:`${14.285714285714286}%`,background:n%2===0?"#c4ffa9":"#b9edff"},children:t},t))});if(a.seeRange===b.月){const t=r(a.startDate).daysInMonth();return e.jsx("div",{style:{display:"flex",textAlign:"center"},children:new Array(t).fill(0).map((n,s)=>e.jsxs("div",{style:{width:`${100/t}%`,background:s%2===0?"#c4ffa9":"#b9edff"},children:[s+1,"号"]},s+a.startDate))})}return a.seeRange===b.年?e.jsx("div",{style:{display:"flex",textAlign:"center"},children:new Array(12).fill(0).map((t,n)=>e.jsxs("div",{style:{width:`${8.333333333333334}%`,background:n%2===0?"#c4ffa9":"#b9edff"},children:[n+1,"月"]},n+a.startDate))}):e.jsx(e.Fragment,{})},p=()=>a.seeRange===b.周?`${14.285714285714286}%`:a.seeRange===b.月?`${100/r(a.startDate).daysInMonth()}%`:`${8.333333333333334}%`,x=(()=>{const t=o.reduce((n,s)=>s.thisTime>n.thisTime?s:n,o[0]);return t?t.thisTime+t.thisTime*.15:0})(),v=()=>{const{seeRange:t,startDate:n}=a,s=[],l=t===b.周?7:t===b.月?r(n).daysInMonth():12;if(t===b.年){for(let u=0;u<l;u++){const g=r(n).add(u,"month").format("YYYY-MM"),T=o.find(f=>f.date===g);T?s.push(T):s.push({startTime:"",totalDuration:0,date:g,thisTime:0,count:0})}return s}for(let u=0;u<l;u++){const g=r(n).add(u,"day").format("YYYY-MM-DD"),T=o.find(f=>f.date===g);T?s.push(T):s.push({startTime:"",totalDuration:0,date:g,thisTime:0,count:0})}return s};return e.jsxs("div",{children:[e.jsx("div",{style:{height:"calc(-153px + 100vh)",display:"flex"},children:o.length>0&&v().map(t=>e.jsx("div",{style:{width:p(),display:"flex",alignItems:"flex-end"},children:t.thisTime!==0&&e.jsx(W,{placement:"right",content:e.jsxs("div",{style:{fontSize:"14px",color:"#999"},children:["日期：",t.date,e.jsx("br",{}),"时长：",m.secondFormat(t.thisTime),e.jsx("br",{}),"观看次数：",t.count]}),children:e.jsx("div",{style:{width:"50%",background:"linear-gradient(180deg, #f1aaa6 0%, #c3b5f1 50%, #a0f1ef 100%)",margin:"0 auto",height:`${t.thisTime/x*100}%`,borderRadius:"50% 0",position:"relative",cursor:"pointer"},onClick:()=>d&&d(t.date),children:e.jsx("div",{style:{position:"absolute",bottom:"101%",left:"-50%",width:"200%",textAlign:"center",color:"#999"},children:m.secondFormat(t.thisTime)})})})},t.date))}),(o.length===0||x===0)&&e.jsx(C,{describe:"您选择的时间段没有观看时间数据哦,真棒!",style:{width:"40vw",margin:" 0 auto"}}),j()]})},ie=({seeDataList:o=[]})=>o.length>0?e.jsxs(E,{size:"large",children:[e.jsxs("b",{children:["总观看时长：",m.secondFormat(o.map(a=>a.thisTime).reduce((a,d)=>a+d,0))]}),e.jsxs("b",{children:["总观看次数：",o.reduce((a,d)=>a+(d.count??0),0)]})]}):e.jsx(e.Fragment,{});let ae=0;const y=1,M=2,$=3,H=4,oe="YYYY/MM/DD",P="MM/DD",le="YYYY/MM";let i={seeRange:y,startDate:r().startOf("day").valueOf(),endDate:r().endOf("day").valueOf()},S=[];const de=()=>{const[,o]=R.useState(0),a=()=>o(++ae);R.useEffect(()=>{j()},[]);const d=()=>({seeRange:i.seeRange,startDate:Math.floor(i.startDate/1e3),endDate:Math.floor(i.endDate/1e3)}),j=async()=>a(S=await ee(d())),p=n=>{const s=l=>{i.seeRange=l,x(r())};return e.jsx(D,{type:"primary",size:"large",style:{margin:"20px 0"},disabled:i.seeRange===n,onClick:()=>s(n),children:F[n]})},x=n=>{i.seeRange===M&&n.day()===0&&(n=n.subtract(1,"day"));let s=n.startOf(Y[i.seeRange]),l=n.endOf(Y[i.seeRange]);i.seeRange===M&&(s=s.add(1,"day"),l=l.add(1,"day")),i.startDate=s.valueOf(),i.endDate=l.valueOf(),a(),j()},v=()=>{switch(i.seeRange){case y:return r(i.startDate).format(oe);case M:return r(i.startDate).format(P)+" ~ "+r(i.endDate).format(P);case $:return r(i.startDate).format(le);case H:return r(i.startDate).format("YYYY");default:return}},t=n=>{i.seeRange===H?(i.seeRange=$,x(r(n,"YYYY-MM"))):(i.seeRange=y,x(r(n,"YYYY-MM-DD")))};return e.jsxs("div",{style:{width:"99%",height:"100%",marginLeft:10},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,height:"calc(100vh - 130px)"},children:[e.jsxs("div",{style:{width:70,textAlign:"center",background:"#f1ffeb",borderRadius:"10px 0 0 10px"},children:[p(y),p(M),p($),p(H)]}),e.jsxs("div",{style:{width:"calc(100% - 70px)",background:"#fffff5",position:"relative",borderRadius:"0 10px 10px 0"},children:[e.jsxs("b",{style:{position:"absolute",top:4,left:8,color:"#999",fontSize:18},children:[r(i.startDate).format("YYYY-MM-DD"),i.seeRange!==y&&" ~ "+r(i.endDate).format("YYYY-MM-DD")]}),i.seeRange===y&&e.jsx(se,{seeDataList:S}),i.seeRange!==y&&e.jsx(ne,{seeDataList:S,seeDataConfig:i,onClick:t})]})]}),e.jsxs(E,{size:"large",children:[e.jsx(D,{onClick:j,children:"刷新"}),e.jsx(D,{onClick:()=>(i.seeRange=y)&&x(r()),children:"今天"}),e.jsxs("div",{children:[e.jsxs(D,{onClick:()=>x(r(i.startDate).subtract(1,Y[i.seeRange])),disabled:r(i.startDate).isBefore(r("2024-08-30")),children:["上一",F[i.seeRange]]}),e.jsx(_,{allowClear:!1,onChange:x,format:v,picker:Y[i.seeRange],value:r(i.startDate),minDate:r("2024-08-30"),maxDate:r()}),e.jsxs(D,{onClick:()=>x(r(i.endDate).add(1,Y[i.seeRange])),disabled:r(i.endDate).isAfter(r()),children:["下一",F[i.seeRange]]})]}),i.seeRange===y&&e.jsx(re,{seeDataList:S}),i.seeRange!==y&&e.jsx(ie,{seeDataList:S})]})]})};let ce=0,h={},k=[],w=!1;function me(){const[,o]=R.useState(0),a=J();let{startTime:d,endTime:j,duration:p,remark:x}=h;R.useEffect(()=>{const s=new URLSearchParams(a.search);if(!s.has("startTime")||!s.has("endTime")||!s.has("duration"))return v(n());try{h.startTime=m.timestampToDate(s.get("startTime")),h.endTime=m.timestampToDate(s.get("endTime")),h.duration=parseInt(s.get("duration")),h.remark=s.get("remark"),w=!0,t()}finally{v()}},[]);const v=()=>o(++ce),t=async()=>{let s=n();s!==-1&&(window.localStorage.setItem(`seeTime${s}`,JSON.stringify(h)),A.isExpired()||await Z({...h,startTime:h.startTime.valueOf(),endTime:h.endTime.valueOf()})&&(h.save=1,window.localStorage.setItem(`seeTime${s}`,JSON.stringify(h))))},n=()=>{var u,g;k=[];let s=1,l=!0;for(;;){let T=window.localStorage.getItem(`seeTime${s}`);if(T){const f=JSON.parse(T);f.startTime=new Date(f.startTime),f.endTime=new Date(f.endTime),((u=f.startTime)==null?void 0:u.toString())===((g=h==null?void 0:h.startTime)==null?void 0:g.toString())&&(l=!1,window.localStorage.setItem(`seeTime${s}`,JSON.stringify(h))),k.unshift(f)}else return l?s:-1;s++}};return e.jsxs("div",{style:{margin:12,display:"flex"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"calc(100vh - 88px)",width:w?"16%":0,transition:"all 0.5s"},children:w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:"22vh"},children:p?e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:x}),e.jsxs("div",{children:[e.jsx("b",{children:"本次开始时间："}),m.format(d)]}),e.jsxs("div",{children:[e.jsx("b",{children:"本次结束时间："}),m.format(j)]}),e.jsxs("div",{children:[e.jsx("b",{children:"本次时长："}),m.millisecondFormat(j.getTime()-d.getTime())]}),e.jsxs("div",{children:[e.jsx("b",{children:"当天总时长："}),m.secondFormat(p)]})]}):e.jsx(U,{description:"数据不足以支持渲染此处。",style:{marginTop:12}})}),e.jsxs("div",{style:{background:"rgba(240,240,240,0.29)",borderRadius:6,flex:1,overflow:"auto"},children:[e.jsx("h3",{style:{textAlign:"center"},children:"本地记录"}),k.length>0?e.jsx(I,{style:{padding:6},children:k.sort((s,l)=>l.startTime-s.startTime).map(s=>{var l;return e.jsx(L,{span:24,style:{marginBottom:6},children:e.jsxs(K,{styles:{body:{paddingTop:12}},title:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[e.jsx("div",{children:s.remark}),e.jsx("div",{children:r(s.startTime).format("YY/MM/DD")})]}),children:[e.jsx("span",{children:r(s.startTime).format("HH:mm:ss")})," ",">>>",e.jsx("span",{children:r(s.endTime).format("HH:mm:ss")}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[e.jsx("div",{children:"本次时长："}),e.jsx("div",{children:m.millisecondFormat(s.endTime.getTime()-s.startTime.getTime())})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[e.jsx("div",{children:"当天总时长："}),e.jsx("div",{children:m.secondFormat(s.duration)})]})]})},(l=s.startTime)==null?void 0:l.valueOf())})}):e.jsx(N,{style:{padding:0},status:"404",title:"Empty",subTitle:"Sorry, 本地好像还没有记录哦."})]})]})}),e.jsx("div",{style:{position:"absolute",top:"50%",left:w?"16%":0,transition:"all 0.5s"},children:e.jsx(D,{shape:"circle",onClick:()=>v(w=!w),icon:e.jsx(V,{style:{transform:w?"unset":"rotate(180deg)",transition:"all 0.5s"}})})}),e.jsx("div",{style:{width:w?"84%":"100%"},children:A.isExpired()?e.jsx(C,{describe:"登录后方可查看观看时间数据~",style:{width:"50vw",margin:" 0 auto"}}):e.jsx(de,{})})]})}const We=z(me);export{We as default};
