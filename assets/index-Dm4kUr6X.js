import{r as R,C as O,j as e,B as D,o as z,a as J,b4 as N}from"./index-A5yLZ6sE.js";import{m as B}from"./myAxios-C3_QTT3r.js";import{J as A}from"./JWTUtils-vY2OjTKT.js";import{d as r,a as f,D as _}from"./DateUtils-X_yZCMtP.js";import{M as C}from"./MyEmpty-Dha62Q2P.js";import{R as I,C as L}from"./row-nJEp4c2c.js";import{P as W}from"./index-r_tzkC_A.js";import{S as E}from"./index-DRMuOqWZ.js";import{E as U}from"./index-Si-64X_t.js";import{C as q}from"./index-DTylntzV.js";import{I as K,_ as X}from"./AntdIcon-BGhW0jrX.js";import{L as G}from"./LeftOutlined-Re7l8AMl.js";import"./index-C0Zqfgkc.js";import"./PurePanel--XuvXQc0.js";import"./useMergedState-CNW99mOk.js";import"./index-D75fbnRN.js";import"./isMobile-BJ3NyRiN.js";import"./Overflow-Duq_5duB.js";import"./index-DsgbjGfF.js";import"./move-C8VxboQH.js";import"./useIcons-DBfnOc4T.js";import"./DownOutlined-CMMP9Q1w.js";import"./SearchOutlined-BMZJ7QSY.js";import"./mediaQueryUtil-hfzWrMGZ.js";import"./colors-BulqiBxK.js";import"./EllipsisOutlined-W2Pnv1Er.js";import"./PlusOutlined-ByZyTB3m.js";import"./Dropdown-CwA9x52j.js";var Q=function(a,d){return R.createElement(K,X({},a,{ref:d,icon:G}))},V=R.forwardRef(Q);async function Z(o){O.setLoading(!0);const a=await B("/other/dySeeTime",o);return a.success&&O.setLoading(!1,"记录成功","success"),a.success}async function ee(o){O.setLoading(!0);const{data:a}=await B("/other/getSeeTime",o);return O.setLoading(!1),a??[]}const F={1:"日",2:"周",3:"月",4:"年"},Y={1:"day",2:"week",3:"month",4:"year"},v={周:2,月:3,年:4},te=["周一","周二","周三","周四","周五","周六","周日"];let m=[];const se=({seeDataList:o})=>{const a=()=>m.length*60*60*1e3,d=t=>`${r(t.endTime).diff(r(t.startTime))/a()*100}%`,p=t=>{const n=r(t.endTime).diff(r(t.startTime));return`${t.thisTime*1e3/n*100}%`},g=(t,n)=>({background:{抖音刷视频外:"#c5daff",抖音刷视频内:"#92b8fa",抖音用户页外:"#fce1ce",抖音用户页内:"#fcc5a3",抖音搜索页外:"#fccedd",抖音搜索页内:"#ffabc6"}[`${t.remark}${n}`]||(n==="外"?"#e1e1e1":"#c0c0c0"),width:n==="外"?d(t):p(t),height:25,borderRadius:5,margin:n==="外"?"5px 0":"unset"}),h=t=>{const n=r(o[0].startTime).startOf("day"),s=m.indexOf(r(t).hour());return`${r(t).hour(s).diff(n)/a()*100}%`};return(()=>{if(m=[],o.length===0)return;for(let s=0;s<o.length;s++){const l=o[s];let x=r(l.startTime).hour(),c=r(l.endTime).hour();c-x<0&&(c=23);for(let T=x;T<=c;T++)!m.includes(T)&&m.push(T)}m.sort((s,l)=>s-l);const t=[m[0]];for(let s=1;s<m.length;s++){const l=m[s]-m[s-1];l===2&&t.push(m[s-1]+1),l>2&&t.push(-1),t.push(m[s])}const n=m[m.length-1];t.push((n+1)%24),n===23&&t.push((n+2)%24),m=t})(),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column-reverse",height:"calc(-153px + 100vh)",overflow:"auto"},children:[o.filter(t=>t.startTime).map(t=>e.jsxs(I,{children:[e.jsx("div",{style:{marginLeft:h(t.startTime)}}),e.jsx(W,{placement:"top",content:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("b",{style:{color:"#646464",fontSize:18},children:t.remark}),e.jsx("br",{}),e.jsxs("b",{children:[r(t.startTime).format("HH:mm:ss")," ~ ",r(t.endTime).format("HH:mm:ss")]}),e.jsxs("div",{children:["打开时间：",f.millisecondFormat(r(t.endTime).diff(r(t.startTime)))]}),e.jsxs("div",{children:["观看时间：",f.secondFormat(t.thisTime)]}),e.jsxs("div",{children:["至此已览：",f.secondFormat(t.totalDuration)]})]}),children:e.jsx("div",{style:g(t,"外"),children:e.jsx("div",{style:g(t,"内")})})}),e.jsx("span",{style:{lineHeight:"34px",marginLeft:3,color:"#999"},children:f.millisecondFormat(r(t.endTime).diff(r(t.startTime)))})]},t.startTime)),o.length===0&&e.jsx(C,{describe:"这天没有观看时间数据哦,真棒!",style:{width:"40vw",margin:" 0 auto"}})]}),e.jsx(I,{children:m.map((t,n)=>e.jsx("div",{style:{textAlign:"center",fontWeight:"bold",width:`${100/m.length}%`,background:n%2===0?"#c4ffa9":"#b9edff"},children:t===-1?"...":`${t}`},n))})]})},re=({seeDataList:o=[]})=>o.length>0?e.jsxs(E,{size:"large",children:[e.jsxs("b",{children:["总时长：",f.millisecondFormat(o.map(a=>{const d=r(a.startTime);return r(a.endTime).diff(d)}).reduce((a,d)=>a+d,0))]}),e.jsxs("b",{children:["观看时长：",f.secondFormat(o.reduce((a,d)=>a+d.thisTime,0))]}),e.jsxs("b",{children:["共看了 ",e.jsx("span",{style:{color:"#ff0000"},children:o.length})," 次"]})]}):e.jsx(e.Fragment,{}),ne=({seeDataList:o,seeDataConfig:a,onClick:d})=>{const p=()=>{if(a.seeRange===v.周)return e.jsx("div",{style:{display:"flex",textAlign:"center"},children:te.map((t,n)=>e.jsx("div",{style:{width:`${14.285714285714286}%`,background:n%2===0?"#c4ffa9":"#b9edff"},children:t},t))});if(a.seeRange===v.月){const t=r(a.startDate).daysInMonth();return e.jsx("div",{style:{display:"flex",textAlign:"center"},children:new Array(t).fill(0).map((n,s)=>e.jsxs("div",{style:{width:`${100/t}%`,background:s%2===0?"#c4ffa9":"#b9edff"},children:[s+1,"号"]},s+a.startDate))})}return a.seeRange===v.年?e.jsx("div",{style:{display:"flex",textAlign:"center"},children:new Array(12).fill(0).map((t,n)=>e.jsxs("div",{style:{width:`${8.333333333333334}%`,background:n%2===0?"#c4ffa9":"#b9edff"},children:[n+1,"月"]},n+a.startDate))}):e.jsx(e.Fragment,{})},g=()=>a.seeRange===v.周?`${14.285714285714286}%`:a.seeRange===v.月?`${100/r(a.startDate).daysInMonth()}%`:`${8.333333333333334}%`,h=(()=>{const t=o.reduce((n,s)=>s.thisTime>n.thisTime?s:n,o[0]);return t?t.thisTime+t.thisTime*.15:0})(),y=()=>{const{seeRange:t,startDate:n}=a,s=[],l=t===v.周?7:t===v.月?r(n).daysInMonth():12;if(t===v.年){for(let x=0;x<l;x++){const c=r(n).add(x,"month").format("YYYY-MM"),w=o.find(T=>T.date===c);w?s.push(w):s.push({startTime:"",totalDuration:0,date:c,thisTime:0,count:0})}return s}for(let x=0;x<l;x++){const c=r(n).add(x,"day").format("YYYY-MM-DD"),w=o.find(T=>T.date===c);w?s.push(w):s.push({startTime:"",totalDuration:0,date:c,thisTime:0,count:0})}return s};return e.jsxs("div",{children:[e.jsx("div",{style:{height:"calc(-153px + 100vh)",display:"flex"},children:o.length>0&&y().map(t=>e.jsx("div",{style:{width:g(),display:"flex",alignItems:"flex-end"},children:t.thisTime!==0&&e.jsx(W,{placement:"right",content:e.jsxs("div",{style:{fontSize:"14px",color:"#999"},children:["日期：",t.date,e.jsx("br",{}),"时长：",f.secondFormat(t.thisTime),e.jsx("br",{}),"观看次数：",t.count]}),children:e.jsx("div",{style:{width:"50%",background:"linear-gradient(180deg, #f1aaa6 0%, #c3b5f1 50%, #a0f1ef 100%)",margin:"0 auto",height:`${t.thisTime/h*100}%`,borderRadius:"50% 0",position:"relative",cursor:"pointer"},onClick:()=>d&&d(t.date),children:e.jsx("div",{style:{position:"absolute",bottom:"101%",left:"-50%",width:"200%",textAlign:"center",color:"#999"},children:f.secondFormat(t.thisTime)})})})},t.date))}),(o.length===0||h===0)&&e.jsx(C,{describe:"您选择的时间段没有观看时间数据哦,真棒!",style:{width:"40vw",margin:" 0 auto"}}),p()]})},ie=({seeDataList:o=[]})=>o.length>0?e.jsxs(E,{size:"large",children:[e.jsxs("b",{children:["总观看时长：",f.secondFormat(o.map(a=>a.thisTime).reduce((a,d)=>a+d,0))]}),e.jsxs("b",{children:["总观看次数：",o.reduce((a,d)=>a+(d.count??0),0)]})]}):e.jsx(e.Fragment,{});let ae=0;const j=1,M=2,$=3,H=4,oe="YYYY/MM/DD",P="MM/DD",le="YYYY/MM";let i={seeRange:j,startDate:r().startOf("day").valueOf(),endDate:r().endOf("day").valueOf()},S=[];const de=()=>{const[,o]=R.useState(0),a=()=>o(++ae);R.useEffect(()=>{p()},[]);const d=()=>({seeRange:i.seeRange,startDate:Math.floor(i.startDate/1e3),endDate:Math.floor(i.endDate/1e3)}),p=async()=>a(S=await ee(d())),g=n=>{const s=l=>{i.seeRange=l,h(r())};return e.jsx(D,{type:"primary",size:"large",style:{margin:"20px 0"},disabled:i.seeRange===n,onClick:()=>s(n),children:F[n]})},h=n=>{i.seeRange===M&&n.day()===0&&(n=n.subtract(1,"day"));let s=n.startOf(Y[i.seeRange]),l=n.endOf(Y[i.seeRange]);i.seeRange===M&&(s=s.add(1,"day"),l=l.add(1,"day")),i.startDate=s.valueOf(),i.endDate=l.valueOf(),a(),p()},y=()=>{switch(i.seeRange){case j:return r(i.startDate).format(oe);case M:return r(i.startDate).format(P)+" ~ "+r(i.endDate).format(P);case $:return r(i.startDate).format(le);case H:return r(i.startDate).format("YYYY");default:return}},t=n=>{i.seeRange===H?(i.seeRange=$,h(r(n,"YYYY-MM"))):(i.seeRange=j,h(r(n,"YYYY-MM-DD")))};return e.jsxs("div",{style:{width:"99%",height:"100%",marginLeft:10},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,height:"calc(100vh - 130px)"},children:[e.jsxs("div",{style:{width:70,textAlign:"center",background:"#f1ffeb",borderRadius:"10px 0 0 10px"},children:[g(j),g(M),g($),g(H)]}),e.jsxs("div",{style:{width:"calc(100% - 70px)",background:"#fffff5",position:"relative",borderRadius:"0 10px 10px 0"},children:[e.jsxs("b",{style:{position:"absolute",top:4,left:8,color:"#999",fontSize:18},children:[r(i.startDate).format("YYYY-MM-DD"),i.seeRange!==j&&" ~ "+r(i.endDate).format("YYYY-MM-DD")]}),i.seeRange===j&&e.jsx(se,{seeDataList:S}),i.seeRange!==j&&e.jsx(ne,{seeDataList:S,seeDataConfig:i,onClick:t})]})]}),e.jsxs(E,{size:"large",children:[e.jsx(D,{onClick:p,children:"刷新"}),e.jsx(D,{onClick:()=>(i.seeRange=j)&&h(r()),children:"今天"}),e.jsxs("div",{children:[e.jsxs(D,{onClick:()=>h(r(i.startDate).subtract(1,Y[i.seeRange])),disabled:r(i.startDate).isBefore(r("2024-08-30")),children:["上一",F[i.seeRange]]}),e.jsx(_,{allowClear:!1,onChange:h,format:y,picker:Y[i.seeRange],value:r(i.startDate),minDate:r("2024-08-30"),maxDate:r()}),e.jsxs(D,{onClick:()=>h(r(i.endDate).add(1,Y[i.seeRange])),disabled:r(i.endDate).isAfter(r()),children:["下一",F[i.seeRange]]})]}),i.seeRange===j&&e.jsx(re,{seeDataList:S}),i.seeRange!==j&&e.jsx(ie,{seeDataList:S})]})]})};let ce=0,u={},k=[],b=!1;function me(){const[,o]=R.useState(0),a=J();let{startTime:d,endTime:p,duration:g,remark:h}=u;R.useEffect(()=>{const s=new URLSearchParams(a.search);if(!s.has("startTime")||!s.has("endTime")||!s.has("duration"))return y(n());try{u.startTime=f.timestampToDate(s.get("startTime")),u.endTime=f.timestampToDate(s.get("endTime")),u.duration=parseInt(s.get("duration")),u.remark=s.get("remark"),b=!0,t()}finally{y()}},[]);const y=()=>o(++ce),t=async()=>{let s=n();s!==-1&&(window.localStorage.setItem(`seeTime${s}`,JSON.stringify(u)),A.isExpired()||await Z({...u,startTime:u.startTime.valueOf(),endTime:u.endTime.valueOf()})&&(u.save=1,window.localStorage.setItem(`seeTime${s}`,JSON.stringify(u))))},n=()=>{k=[];let s=1,l=!0;for(;;){let x=window.localStorage.getItem(`seeTime${s}`);if(x){const c=JSON.parse(x);c.startTime=new Date(c.startTime),c.endTime=new Date(c.endTime),c.startTime?.toString()===u?.startTime?.toString()&&(l=!1,window.localStorage.setItem(`seeTime${s}`,JSON.stringify(u))),k.unshift(c)}else return l?s:-1;s++}};return e.jsxs("div",{style:{margin:12,display:"flex"},children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"calc(100vh - 88px)",width:b?"16%":0,transition:"all 0.5s"},children:b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:"22vh"},children:g?e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:h}),e.jsxs("div",{children:[e.jsx("b",{children:"本次开始时间："}),f.format(d)]}),e.jsxs("div",{children:[e.jsx("b",{children:"本次结束时间："}),f.format(p)]}),e.jsxs("div",{children:[e.jsx("b",{children:"本次时长："}),f.millisecondFormat(p.getTime()-d.getTime())]}),e.jsxs("div",{children:[e.jsx("b",{children:"当天总时长："}),f.secondFormat(g)]})]}):e.jsx(U,{description:"数据不足以支持渲染此处。",style:{marginTop:12}})}),e.jsxs("div",{style:{background:"rgba(240,240,240,0.29)",borderRadius:6,flex:1,overflow:"auto"},children:[e.jsx("h3",{style:{textAlign:"center"},children:"本地记录"}),k.length>0?e.jsx(I,{style:{padding:6},children:k.sort((s,l)=>l.startTime-s.startTime).map(s=>e.jsx(L,{span:24,style:{marginBottom:6},children:e.jsxs(q,{styles:{body:{paddingTop:12}},title:e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[e.jsx("div",{children:s.remark}),e.jsx("div",{children:r(s.startTime).format("YY/MM/DD")})]}),children:[e.jsx("span",{children:r(s.startTime).format("HH:mm:ss")})," ",">>>",e.jsx("span",{children:r(s.endTime).format("HH:mm:ss")}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[e.jsx("div",{children:"本次时长："}),e.jsx("div",{children:f.millisecondFormat(s.endTime.getTime()-s.startTime.getTime())})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[e.jsx("div",{children:"当天总时长："}),e.jsx("div",{children:f.secondFormat(s.duration)})]})]})},s.startTime?.valueOf()))}):e.jsx(N,{style:{padding:0},status:"404",title:"Empty",subTitle:"Sorry, 本地好像还没有记录哦."})]})]})}),e.jsx("div",{style:{position:"absolute",top:"50%",left:b?"16%":0,transition:"all 0.5s"},children:e.jsx(D,{shape:"circle",onClick:()=>y(b=!b),icon:e.jsx(V,{style:{transform:b?"unset":"rotate(180deg)",transition:"all 0.5s"}})})}),e.jsx("div",{style:{width:b?"84%":"100%"},children:A.isExpired()?e.jsx(C,{describe:"登录后方可查看观看时间数据~",style:{width:"50vw",margin:" 0 auto"}}):e.jsx(de,{})})]})}const We=z(me);export{We as default};
